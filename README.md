# Техническое задание - Request Manager

Система управления запросами с использованием вебхуков на Node.js, Express и TypeScript. Приложение отправляет запросы на внешний API, получает вебхук-коллбэки и управляет секретными данными через админ-панель.

## Функционал

- Отправка API-запросов с кастомными сообщениями
- Получение и обработка вебхук-коллбэков с секретными данными
- Веб-интерфейс для управления запросами
- Файловое хранилище для данных запросов и секретов
- Проверка запросов путем объединения частей секрета
- Автообновление данных в админ-панели

## Технологии

- **Backend**: Node.js, Express.js
- **Язык**: TypeScript
- **Frontend**: HTML/CSS/JavaScript
- **Хранилище**: JSON файлы

## Требования

- Node.js (v14+)
- npm или yarn

## Установка

1. Клонирование репозитория:
```bash
git clone <repository-url>
cd Texnik-Topshiriq
```

2. Установка зависимостей:
```bash
npm install
```

3. Создание `.env` файла (опционально):
```env
PORT=3000
WEBHOOK_BASE_URL=http://your-server-url.com
```

**Примечание**: Если `WEBHOOK_BASE_URL` не указан, используется хост текущего запроса. Сервер должен быть доступен из интернета для получения вебхук-коллбэков.

## Запуск

### Режим разработки

```bash
npm run dev
```

Сервер запустится на `http://localhost:3000` (или указанный в `.env` порт).

### Production режим

1. Сборка TypeScript:
```bash
npm run build
```

2. Запуск:
```bash
npm start
```

## API эндпоинты

### `POST /v1/send/request`
Отправка нового запроса на внешний API.

**Тело запроса:**
```json
{
  "message": "Hello from Avazbek"
}
```

**Ответ:**
```json
{
  "succes": true,
  "message": "Request was sent succesfully!",
  "requestId": "uuid-here"
}
```

### `POST /v1/recieve/secret/:requestId`
Вебхук-эндпоинт для получения секретных данных (часть 2).

**Ответ:** `204 No Content`

### `GET /v1/secrets/:requestId`
Получение конкретного запроса по ID.

**Ответ:**
```json
{
  "success": true,
  "data": {
    "requestId": "uuid-here",
    "part1": {...},
    "part2": {...},
    "createdAt": "2024-01-01T00:00:00.000Z",
    "completedAt": "2024-01-01T00:00:00.000Z"
  }
}
```

### `GET /v1/secrets`
Получение всех запросов.

**Ответ:**
```json
{
  "success": true,
  "data": {
    "request-id-1": {...},
    "request-id-2": {...}
  }
}
```

### `POST /v1/check/:requestId`
Проверка запроса путем объединения частей секрета.

**Ответ:**
```json
{
  "success": true,
  "data": {...},
  "combinedCode": "code1code2"
}
```

## Логика работы

### Процесс отправки запроса

1. Клиент отправляет POST запрос на `/v1/send/request` с сообщением
2. Сервер генерирует уникальный `requestId` (UUID)
3. Отправляется запрос на внешний API с указанием webhook URL (`/v1/recieve/secret/:requestId`)
4. Сохраняется `part1` секрета в `secrets.json`
5. Возвращается `requestId` клиенту

### Получение вебхука

1. Внешний API отправляет POST запрос на `/v1/recieve/secret/:requestId`
2. Сервер получает `part2` секрета
3. Данные сохраняются в `secrets.json` для соответствующего `requestId`
4. Устанавливается время `completedAt`

### Проверка запроса

1. Клиент отправляет POST на `/v1/check/:requestId`
2. Сервер извлекает `part1` и `part2` из хранилища
3. Объединяются коды из обеих частей
4. Возвращается объединенный код

## Админ-панель

Доступна по адресу `http://localhost:3000/`

Функции:
- Создание новых запросов
- Просмотр всех запросов и их статусов
- Детали запроса (part1, part2, результат проверки)
- Проверка запросов
- Автообновление каждые 10 секунд

## Структура проекта

```
Texnik-Topshiriq/
├── dist/                 # Скомпилированный JavaScript
├── node_modules/         # Зависимости
├── public/              # Статические файлы
│   └── admin.html       # Админ-панель
├── src/                 # Исходный код
│   └── index.ts         # Главный файл приложения
├── .env                 # Переменные окружения
├── package.json         # Зависимости проекта
├── tsconfig.json        # Конфигурация TypeScript
└── secrets.json         # Хранилище запросов (создается автоматически)
```

## Конфигурация

### Переменные окружения

- `PORT`: Порт сервера (по умолчанию: 3000)
- `WEBHOOK_BASE_URL`: Базовый URL для вебхук-коллбэков (если не указан, используется хост текущего запроса)

## Хранилище данных

Все данные запросов хранятся в файле `secrets.json` в корне проекта. Файл создается автоматически при первом запросе.

**Примечание**: Добавьте `secrets.json` в `.gitignore` если файл содержит конфиденциальные данные.

## Автор

Avazbek
